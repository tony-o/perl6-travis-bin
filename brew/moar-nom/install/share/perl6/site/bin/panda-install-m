#!/usr/bin/env perl6-m
sub MAIN(:$name is copy, :$auth, :$ver, *@, *%) {
    shift @*ARGS if $name;
    shift @*ARGS if $auth;
    shift @*ARGS if $ver;
    $name //= 'panda';
    my @installations = $*REPO.repo-chain.grep(CompUnit::Repository::Installable);
    my @binaries = flat @installations.map: { .files('bin/panda-install', :$name, :$auth, :$ver) };
    unless +@binaries {
        @binaries = flat @installations.map: { .files('bin/panda-install') };
        if +@binaries {
            note q:to/SORRY/;
                ===SORRY!===
                No candidate found for 'panda-install' that match your criteria.
                Did you perhaps mean one of these?
                SORRY
            my %caps = :name(['Distribution', 12]), :auth(['Author(ity)', 11]), :ver(['Version', 7]);
            for @binaries -> $dist {
                for %caps.kv -> $caption, @opts {
                    @opts[1] = max @opts[1], ($dist{$caption} // '').Str.chars
                }
            }
            note '  ' ~ %caps.values.map({ sprintf('%-*s', .[1], .[0]) }).join(' | ');
            for @binaries -> $dist {
                note '  ' ~ %caps.kv.map( -> $k, $v { sprintf('%-*s', $v.[1], $dist{$k} // '') } ).join(' | ')
            }
        }
        else {
            note "===SORRY!===\nNo candidate found for 'panda-install'.\n";
        }
        exit 1;
    }

    exit run($*EXECUTABLE, @binaries[0].hash.<files><bin/panda-install>, @*ARGS).exitcode
}